f# AutoSort - 自动整理下载文件夹

一个基于 Qt 的自动文件整理工具，可以按文件扩展名自动分类整理下载文件夹中的文件。

## 功能特性

- **后台运行**：程序最小化到系统托盘，不占用任务栏空间
- **实时监控**：自动监控下载文件夹，新文件自动整理
- **按扩展名分类**：根据文件扩展名自动分类到不同文件夹
- **自定义规则**：支持自定义文件扩展名和对应的目标文件夹
- **系统托盘集成**：通过系统托盘图标快速访问所有功能
- **命令行支持**：支持多种命令行参数
- **智能下载检测**：自动检测文件是否下载完成，避免移动未完成的文件
- **临时文件排除**：自动排除各种下载临时文件（.tmp, .crdownload, .part 等）
- **文件移动而非复制**：直接移动文件，不占用额外磁盘空间

## 默认分类规则

程序预置了以下分类规则：

- **文档**：pdf, doc, docx, txt, rtf, odt
- **表格**：xls, xlsx, csv
- **演示文稿**：ppt, pptx
- **图片**：jpg, jpeg, png, gif, bmp, tiff, svg, webp, ico
- **视频**：mp4, avi, mkv, mov, wmv, flv, webm, m4v, 3gp
- **音频**：mp3, wav, flac, aac, ogg, wma, m4a
- **压缩文件**：zip, rar, 7z, tar, gz, bz2, xz
- **程序**：exe, msi, deb, rpm, dmg, pkg, appimage
- **代码**：cpp, c, h, hpp, java, py, js, html, css, php, rb, go, rs, swift, kt, ts

## 使用方法

### 启动程序

```bash
# 正常启动（显示主窗口）
AutoSort.exe

# 隐藏启动（直接最小化到系统托盘）
AutoSort.exe --hidden

# 立即整理一次后退出
AutoSort.exe --organize

# 显示帮助信息
AutoSort.exe --help
```

### 系统托盘操作

- **双击图标**：显示/隐藏主窗口
- **右键菜单**：
  - 开始/停止监控
  - 立即整理
  - 设置
  - 关于
  - 退出

### 主窗口操作

1. **开始监控**：点击"开始监控"按钮，程序开始实时监控下载文件夹
2. **停止监控**：点击"停止监控"按钮，暂停文件监控
3. **立即整理**：立即执行一次文件整理
4. **设置**：打开设置对话框，配置下载路径和整理规则

### 设置说明

#### 通用设置
- **下载路径**：设置要监控和整理的文件夹路径（默认为系统下载文件夹）
- **开机自动启动**：设置程序随系统启动
- **最小化到系统托盘**：最小化时隐藏到托盘
- **启动时最小化**：程序启动时自动最小化
- **整理延迟**：设置文件变动后延迟整理的时间（秒）
- **启用通知**：是否显示整理完成的通知

#### 规则设置
- **添加规则**：添加自定义的文件扩展名和目标文件夹
- **删除规则**：删除选中的规则
- **重置默认**：恢复默认的分类规则
- **导入/导出**：导入或导出规则配置

#### 高级设置
- **日志记录**：启用日志记录功能
- **备份文件**：整理前备份文件到指定位置

## 编译说明

### 环境要求
- CMake 3.16.0 或更高版本
- Qt 6.x
- MinGW 或 MSVC 编译器

### 编译步骤

```bash
mkdir build
cd build
cmake .. -G "MinGW Makefiles"
cmake --build .
```

## 文件结构

```
autosort/
├── CMakeLists.txt          # CMake 配置文件
├── README.md               # 说明文档
├── resources/
│   └── icon.svg           # 程序图标
└── src/
    ├── main.cpp           # 主程序入口
    ├── mainwindow.cpp/h   # 主窗口类
    ├── fileorganizer.cpp/h # 文件整理核心类
    ├── settingsdialog.cpp/h # 设置对话框类
```

## 注意事项

1. 程序需要系统托盘支持，如果系统托盘不可用则无法正常运行
2. 文件整理时，如果目标文件夹已存在同名文件，会自动重命名（添加序号）
3. 程序默认监控用户的下载文件夹，可以在设置中修改
4. 建议设置适当的整理延迟，避免文件下载过程中被移动

## 智能下载检测

程序会自动检测文件是否正在下载中，避免移动未完成的文件：

1. **临时文件排除**：自动排除以下临时文件：
   - `.tmp`, `.temp` - 通用临时文件
   - `.crdownload` - Chrome/Edge 浏览器下载临时文件
   - `.part` - Firefox 浏览器下载临时文件
   - `.partial`, `.download` - 其他下载工具临时文件
   - `.!qb`, `.!ut` - qBittorrent/uTorrent 临时文件
   - `.aria2`, `.td`, `.pdownload` - 其他下载管理器临时文件
   - 以 `~` 开头的文件或隐藏文件（以 `.` 开头）

2. **文件锁定检测**：通过尝试打开文件检测文件是否被下载程序占用

3. **自动重试**：如果检测到文件正在下载中，程序会等待 10 秒后再次尝试整理

4. **下载完成检测**：当临时文件被重命名为正式文件时，触发整理操作

## 注意事项

1. 程序需要系统托盘支持，如果系统托盘不可用则无法正常运行
2. 文件整理时，如果目标文件夹已存在同名文件，会自动重命名（添加序号）
3. 程序默认监控用户的下载文件夹，可以在设置中修改
4. 建议设置适当的整理延迟（默认 5 秒），给文件下载留出足够时间
5. 程序会直接移动文件，不会保留原文件（不会复制）
6. 对于大文件下载，可能需要更长的检测时间，可以在设置中调整延迟

## 许可证

本项目仅供学习和个人使用。
